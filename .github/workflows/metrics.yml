name: Metrics
on:
  # Schedule daily updates
  schedule: [{ cron: "0 0 * * *" }]
  # Allow manual trigger
  workflow_dispatch:
  # Update when pushing to master
  push: { branches: ["master"] }

jobs:
  github-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      # Using hxreborn/metrics fork until PR #1754 is merged into lowlighter/metrics
      # Fixes: GitHub Events API removed commit details, breaking recently-used languages
      # See: https://github.com/lowlighter/metrics/pull/1754
      - uses: hxreborn/metrics@fix-recent-languages
        with:
          # GitHub token
          token: ${{ secrets.METRICS_TOKEN }}

          # Options
          user: hxreborn
          template: classic
          filename: metrics.svg

          # Base info
          base: header, metadata
          repositories_forks: no
          commits_authoring: 32096750+hxreborn@users.noreply.github.com, hxreborn

          plugin_languages: yes
          plugin_languages_ignored: markdown, smali, renderscript
          plugin_languages_limit: 6
          plugin_languages_aliases: rs=Rust
          plugin_languages_sections: most-used, recently-used
          plugin_languages_details: lines
          plugin_languages_indepth: yes
          plugin_languages_analysis_timeout: 60
          plugin_languages_analysis_timeout_repositories: 15
          plugin_languages_recent_load: 400
          plugin_languages_recent_days: 16

          plugin_notable: yes
          plugin_notable_from: organization
          plugin_notable_repositories: no
          plugin_notable_indepth: no
          plugin_notable_types: pull_request
          plugin_notable_limit: 3

          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year
          plugin_isocalendar_colors: github

          config_output: markdown-details
          config_padding: 0, 10%

          repositories_skipped: superpowergpt-userdata-backup, s5cmd, sketchybar-config, dotfiles, revanced-magisk-module, zsh-config
